# Лабораторная работа 1: Создание карт застройки и землепользования в QGIS

**Дедлайн работы – 16.11 23:59**

---

## Примечание:

1. Приведённый план действий — это примерный порядок работы. Вы можете выполнить задание любым удобным для вас способом, главное — прийти к конечному результату.
2. Описание задания носит общий характер, более подробно шаги разбираются на семинаре.
3. Рекомендуется работать в англоязычной версии программы.

---

### Описание задания

**Задача:** Создать карты застройки (шварцплан) и землепользования для выбранного участка города.

На карте должны быть:

- Расчёты процента застроенной территории
- Доли различных типов землепользования

К карте должно прилагаться краткое описание исследуемой территории.

> **Примечание:** Рекомендуемый радиус исследуемой территории — не более 3 км. (см. этап работы 4). Не забудьте включить все обязательные элементы карты (см. презентацию с занятия).

---

### Перед началом работы

1. Создайте директорию на компьютере для данной лабораторной работы, где будут храниться данные и проект. Структуру хранения данных можно найти в презентации к занятию.
2. Измените язык QGIS на английский:
   - Перейдите в меню **Настройки** → **Параметры**.
   - В открывшемся окне выберите вкладку **Язык**.
   - Установите галочку напротив **Переопределить язык системы** и выберите **English** из выпадающего списка.
   - Нажмите **ОК** для сохранения изменений.
   - Перезапустите QGIS, чтобы изменения вступили в силу.

---

### Этап 1: Выгрузка данных из OpenStreetMap и их сохранение

В этом задании мы будем использовать данные из OpenStreetMap (OSM). Существует несколько способов выгрузки данных, но для этой работы мы рекомендуем использовать плагин **Quick OSM** в QGIS.

1. **Установка Quick OSM**:

   - Перейдите в меню **Plugins** → **Manage and Install Plugins** и найдите **QuickOSM** через поиск.
   - После установки плагин будет доступен через **Vector** → **Quick OSM**.

2. **Настройка и загрузка данных**:
   - В поле **key** укажите тип объекта (например, для зданий используйте `buildings`).
   - В поле **value** укажите класс объекта (если необходимо).
   - В поле **in** можно ввести название места для скачивания данных, выбрать экстент открытого окна или экстент определённого слоя.

> **Полезная информация**: OSM использует ключи и значения для обозначения объектов, их описание можно найти на [Wiki OSM](https://wiki.openstreetmap.org/wiki/Map_features).

3. **Типы данных для первой и второй карты**:
   - Для первой карты необходимы данные о зданиях (`key = buildings`) и, возможно, гидрография, если она попадает в ваш участок (`key = natural, value = water`).
   - Для второй карты могут пригодиться данные о землепользовании (`key = landuse`), автомобильных дорогах (`key = highway`) и железных дорогах (`key = railway`).

> **Важно**: Выполняйте запросы для разных типов данных поочередно.

4. **Сохранение слоёв**:
   - После выгрузки слои в QGIS являются временными, также они сохраняются в виде разных типов геометрий.
   - Для сохранения нужных слоёв кликните правой кнопкой мыши на слой → **Export** → **Save Features As**:
     - Выберите формат данных (например, **ESRI Shapefile**).
     - Установите **CRS** — выбирайте спроецированную систему координат, **WGS-84 UTM zone** с номером зоны, соответствующей вашей территории (как определить номер зоны, разбиралось на занятии).

---

### Этап 2: Настройки визуализации

Теперь, когда данные загружены, приступим к их оформлению!

Для оформления активируйте **Layer Styling Panel**:

- Кликните правой кнопкой мыши на пустом месте верхней панели и поставьте галочку напротив **Layer Styling Panel**.
- В открывшемся окне справа будут настройки для активного слоя (активный слой — тот, который выделен в списке слоев слева).

1. **Оформление зданий**:

   - Начните с выделения и настройки слоя со зданиями.
   - Выберите тип визуализации — **Single Symbol** и закрасьте их в чёрный или любой другой цвет, контрастный белому.

2. **Оформление землепользования**:

   - Для участков землепользования определите цвет в зависимости от атрибута, описывающего тип участка.
   - Используйте тип визуализации — **Categorized**, выбрав поле **Value** с указанием типа землепользования.

3. **Оформление дорог**:
   - Примените визуальные стили для дорог, водоёмов и других элементов, которые планируете отобразить на карте.

> **Примечание:** Следите за порядком слоев (например, чтобы ж/д не уходили под воду).

---

### Этап 3: Определение области исследования

#### Этап 3.1: Создание круга заданным радиусом и его сохранение

Для создания круга с заданным радиусом в QGIS и его сохранения следуйте этим шагам:

1. **Определите центральную точку исследования:**

   - Если вы уже знаете координаты центра исследуемого участка, создайте точку в этом месте.
   - Если нет, выберите ориентировочный центр интересующей вас зоны на карте.

2. **Создайте точечный слой для центральной точки:**

   - Перейдите в меню **Layer** → **Create Layer** → **New Shapefile Layer**.
   - В открывшемся окне выберите **Point** (точка) в качестве типа геометрии.
   - Задайте имя слоя (например, "Central_Point") и выберите систему координат, которая соответствует вашей области исследования (например, UTM зоны вашего региона).
   - Нажмите **OK** для создания слоя.

3. **Добавьте точку в новый слой:**

   - Активируйте режим редактирования для слоя, щёлкнув по нему правой кнопкой мыши в панели **Layers** и выбрав **Toggle Editing**.
   - Выберите инструмент **Add Point** (Добавить точку) в панели инструментов и щёлкните на карте в месте, выбранном как центр.
   - Остановите режим редактирования, выбрав **Save Edits** для сохранения добавленной точки.

4. **Создайте круг радиусом заданным радиусом:**

   - Перейдите в меню **Processing** → **Toolbox** и найдите инструмент **Buffer** (Буфер) (можно найти через строку поиска).
   - В окне **Buffer** установите:
     - **Input layer** (Входной слой) — слой с центральной точкой (например, "Central_Point").
     - **Distance** (Расстояние) — например, введите 3000 метров (для радиуса 3 км).
     - **Segments** (Сегменты) — значение по умолчанию, обычно 30, можно увеличить для создания более гладкого круга.
     - Выберите подходящий **Output layer** (Имя выходного слоя) и формат для сохранения, например, **Shapefile** или **GeoPackage**.
   - Нажмите **Run** (Запуск), чтобы создать круг радиусом 3 км вокруг центральной точки.

5. **Проверьте и сохраните круг:**
   - Убедитесь, что круг отображается правильно на карте.
   - Сохраните полученный слой с кругом в предпочитаемом формате (Shapefile или GeoPackage) для дальнейшего использования на следующих этапах анализа.

Теперь у вас есть круговой полигон, ограничивающий область исследования радиусом 3 км. Этот слой будет использоваться для обрезки данных в следующих шагах.

#### Этап 3.2: Обрезка зданий и землепользования по границе круга

На этом этапе мы создадим обрезанные версии слоёв зданий и землепользования, ограниченные границами круга радиусом 3 км. Этот процесс позволит сфокусировать анализ на интересующем участке и исключить данные за его пределами.

1. **Подготовка к обрезке слоёв**:

   - Убедитесь, что слой круга, созданного на этапе 3.1, загружен в проект и видим на карте.
   - Проверьте, что у вас есть необходимые слои для зданий и землепользования, которые вы хотите обрезать по границе круга.

2. **Используйте инструмент Clip (Обрезка) для слоя зданий**:

   - Откройте **Processing Toolbox** (Панель инструментов обработки), выбрав **View** → **Panels** → **Processing Toolbox**, если панель ещё не открыта.
   - Введите в строке поиска инструментов "Clip" или найдите его в разделе **Vector overlay** (Наложение векторных данных).
   - В настройках инструмента **Clip**:
     - **Input layer** (Входной слой) — выберите слой зданий, который нужно обрезать.
     - **Overlay layer** (Накладываемый слой) — выберите слой с кругом радиусом 3 км.
     - **Output layer** (Выходной слой) — укажите название и место для сохранения обрезанного слоя зданий. Можно выбрать формат **Shapefile** или **GeoPackage** для сохранения.
   - Нажмите **Run** (Запуск) для выполнения обрезки.
   - После завершения процесса обрезанный слой зданий будет автоматически добавлен на карту и отобразит только те здания, которые находятся внутри круга.

3. **Обрезка слоя землепользования**:

   - Повторите процесс, описанный выше, для слоя землепользования.
   - В настройках инструмента **Clip**:
     - **Input layer** — выберите слой землепользования.
     - **Overlay layer** — выберите слой с кругом радиусом 3 км.
     - **Output layer** — задайте имя и выберите место для сохранения нового слоя землепользования.
   - Нажмите **Run** для выполнения обрезки.
   - После завершения вы получите новый слой землепользования, обрезанный по границе круга радиусом 3 км.

4. **Проверка результатов**:

   - Убедитесь, что оба обрезанных слоя загружены в проект и корректно отображаются на карте.
   - Отключите исходные слои зданий и землепользования, чтобы лучше видеть результаты обрезки.

5. **Сохранение обрезанных слоёв**:
   - После проверки убедитесь, что обрезанные слои сохранены в подходящем формате (**Shapefile** или **GeoPackage**), чтобы их можно было использовать на следующих этапах анализа и визуализации.

Теперь у вас есть обрезанные по кругу слои зданий и землепользования, которые можно будет использовать для дальнейших расчётов и визуализации.

---

### Этап 4: Расчёты

#### Этап 4.1: Расчёт доли различных типов землепользования

На этом этапе мы рассчитаем долю каждого типа землепользования в пределах круга радиусом 3 км. Эти данные будут полезны для анализа распределения использования территории в выбранном районе.

1. **Расчёт площади для каждого типа землепользования**:

   - Откройте атрибутивную таблицу обрезанного слоя землепользования (правой кнопкой мыши на слой → **Open Attribute Table**).
   - Если в таблице нет столбца с площадями, добавьте его:
     - Перейдите в режим редактирования (**Toggle Editing Mode**).
     - Откройте **Field Calculator** (Калькулятор полей) с помощью значка или меню **Layer** → **Field Calculator**.
     - Создайте новый столбец (например, "Area_sq_m") и выберите **Decimal number** для типа данных.
     - В поле **Expression** введите выражение `$area`, которое автоматически рассчитает площадь для каждого полигона в квадратных метрах. Нажмите **OK** для сохранения результатов.
   - Теперь у каждого полигона будет указана его площадь в новом столбце "Area_sq_m".

2. **Вычисление процентного соотношения каждого типа землепользования**:

   - Сгруппируйте полигоны по типам землепользования, чтобы узнать суммарную площадь для каждого типа:
     - Перейдите в **Processing Toolbox** → найдите инструмент **Group Stats** или **Statistics by categories** (если доступно).
     - Укажите обрезанный слой землепользования в качестве **Input layer**.
     - Выберите поле, где указан тип землепользования, как **Category field**.
     - Укажите столбец с площадью "Area_sq_m" как **Values field** и выберите **Sum** (сумму), чтобы получить общую площадь для каждого типа землепользования.
   - Запишите результаты или экспортируйте их в таблицу, чтобы получить сумму площадей для каждого типа землепользования.
   - Рассчитайте долю каждого типа, разделив его суммарную площадь на общую площадь круга:
     - Общую площадь круга можно получить из атрибутов слоя круга (или вручную вычислить её как π \* (3000 м)^2).
     - Для каждого типа вычислите процент, разделив площадь типа на общую площадь и умножив на 100%.

3. **Сохранение результатов**:
   - Занесите результаты расчётов в таблицу атрибутов слоя землепользования или сохраните их в отдельный текстовый документ или электронную таблицу. Эта таблица будет полезна для отчёта и добавления на итоговую карту.

---

#### Этап 4.2: Расчёт процента застроенной территории

На этом этапе мы вычислим, какой процент территории внутри круга занимает застройка (здания), что позволит оценить плотность застройки на исследуемом участке.

1. **Расчёт общей площади застройки**:

   - Откройте атрибутивную таблицу обрезанного слоя зданий и убедитесь, что в ней есть столбец с площадями.
   - Если столбец с площадями отсутствует, добавьте его с помощью **Field Calculator**:
     - Перейдите в режим редактирования, откройте **Field Calculator** и создайте новый столбец (например, "Building_Area_sq_m").
     - Введите выражение `$area` для расчёта площади зданий в квадратных метрах и нажмите **OK** для сохранения.
   - Используйте инструмент **Statistics by categories** или **Group Stats** (в зависимости от версии QGIS) для суммирования площадей всех зданий.
     - В настройках выберите слой зданий как **Input layer** и поле с площадями "Building_Area_sq_m" как **Values field** с функцией **Sum**.
     - Запишите или экспортируйте полученную сумму — это будет общая площадь застройки.

2. **Вычисление процента застроенной территории**:

   - Найдите общую площадь круга (из атрибутов круга или рассчитав её по формуле π \* (3000 м)^2).
   - Рассчитайте процент застроенной территории, разделив общую площадь застройки на площадь круга и умножив на 100%:
     \[
     \text{Процент застройки} = \frac{\text{Общая площадь застройки}}{\text{Площадь круга}} \times 100\%
     \]

3. **Сохранение результата**:
   - Сохраните полученный процент в отдельный текстовый документ, таблицу или атрибутивную таблицу слоя круга для использования на этапе визуализации.
   - Этот показатель можно будет включить на итоговую карту, чтобы наглядно показать плотность застройки на исследуемом участке.

---

### Этап 5: Создание Layout с двумя картами

1. Перейдите в меню **Project** → **Layout Manager** и создайте новый макет (Layout).
2. Добавьте два картографических фрейма (Map).
   - В первом фрейме отобразите слой зданий и гидрографию.
   - Во втором фрейме отобразите слои землепользования, дорог, железных дорог и гидрографии.

#### Использование тем (Themes) в QGIS

1. Темы позволяют сохранять разные комбинации видимых слоёв, что упрощает работу с макетами карт.
2. Настройте видимость слоёв для каждой карты:
   - В панели **Layers** включите и отключите слои в зависимости от требуемого содержания.
   - Создайте тему: выберите **View** → **Layer Styling** → **Themes** → **Add Theme**. Назовите тему, например, "Buildings" для первой карты и "Landuse" для второй.
3. В **Layout Manager** при добавлении фреймов выберите соответствующую тему для каждой карты, чтобы показать нужные слои.

---

### Этап 6: Добавление элементов карты

1. **Название**: Вставьте текстовый элемент для заголовка карты, отразив тематику карты.
2. **Легенда**: Добавьте легенду для обозначения типов землепользования, категорий зданий и других данных.
3. **Масштабная линейка**: Вставьте элемент масштабной линейки, выбрав подходящий единичный отрезок.
4. **Расчетные значения**: Добавьте текстовые элементы с результатами расчётов из этапов 4.1 и 4.2 (доли землепользования и процент застроенной территории).

---

### Этап 7: Сохранение итогового изображения

1. В **Layout Manager** выберите **Export as Image** (Экспортировать как изображение) и сохраните итоговый макет в формате PNG или JPEG.
2. Проверьте качество изображения, чтобы оно подходило для отчёта.

---

### Итог

После завершения работы у вас должны получиться две карты на одном листе, отражающие застройку и распределение землепользования на выбранном участке. На этом листе также должны быть приведены следующие расчёты:

- Процент застроенной территории
- Доли разных типов землепользования

**Сдача работы:** В ЛМС загрузите карту (в формате PNG, JPEG) и краткое описание исследуемой территории в отдельном текстовом документе.

**Удачи!**
