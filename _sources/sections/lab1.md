# Лабораторная работа 1

## Создание карт застройки и землепользования в QGIS

**Дедлайн работы – 16.11 23:59**

---

**Примечание:**

1. Приведённый план действий — это примерный порядок работы. Вы можете выполнить задание любым удобным для вас способом, главное — прийти к конечному результату.
2. Описание задания носит общий характер, более подробно шаги разбираются на семинаре.
3. Рекомендуется работать в англоязычной версии программы.

---

### Описание задания

**Задача:** Создать карты застройки (шварцплан) и землепользования для выбранного района города.

На карте должны быть:

- Расчёты процента застроенной территории
- Доли различных типов землепользования

К карте должно прилагаться краткое описание исследуемой территории.

> **Примечание:** Рекомендуется выбрать любой район Москвы или Санкт-Петербурга, но можно работать и с другими городами. Не забудьте включить все обязательные элементы карты (см. презентацию с занятия).

---

### Перед началом работы

1. Создайте директорию на компьютере для данной лабораторной работы, где будут храниться данные и проект. Структуру хранения данных можно найти в презентации к занятию.
2. Установите [QGIS - LTR версию](https://www.qgis.org/download/)
3. Измените язык QGIS на английский:
   - Перейдите в меню **Настройки** → **Параметры**.
   - В открывшемся окне выберите вкладку **Язык**.
   - Установите галочку напротив **Переопределить язык системы** и выберите **English** из выпадающего списка.
   - Нажмите **ОК** для сохранения изменений.
   - Перезапустите QGIS, чтобы изменения вступили в силу.

---

### Этап 1: Выгрузка данных из OpenStreetMap и их сохранение

В этом задании мы будем использовать данные из OpenStreetMap (OSM). Существует несколько способов выгрузки данных, но для этой работы мы рекомендуем использовать плагин **Quick OSM** в QGIS.

1. **Установка Quick OSM**:

   - Перейдите в меню **Plugins** → **Manage and Install Plugins** и найдите **QuickOSM** через поиск.
   - После установки плагин будет доступен через **Vector** → **Quick OSM**.

2. **Загрузка данных**:
   - В поле **key** укажите тип объекта (например, для зданий используйте `building`).
   - В поле **value** укажите класс объекта (если необходимо).
   - В поле **in** можно ввести название места для скачивания данных, выбрать экстент открытого окна или экстент определённого слоя.

> **Полезная информация**: OSM использует ключи и значения для обозначения объектов, их описание можно найти на [Wiki OSM](https://wiki.openstreetmap.org/wiki/Map_features).

3. **Типы данных наших карт**:
   - Загрузите границы исследумого района (`key = admin_level`) + in - название района+название города или название города
   - Для первой карты необходимы данные о зданиях (`key = building`) и, возможно, гидрография, если она попадает в ваш участок (`key = natural, value = water`); + in - название района+название города или название города, или экстент границ районов города - данных, полученных в предыдущем пункте
   - Для второй карты могут пригодиться данные о землепользовании (`key = landuse`), автомобильных дорогах (`key = highway`) и железных дорогах (`key = railway`); + in - название района+название города или название города, или экстент границ районов города - данных, полученных в предыдущем пункте

> **Важно**: Выполняйте запросы для разных типов данных поочередно, в

4. **Сохранение слоёв**:
   - После выгрузки слои в QGIS являются временными, также они выгружаются в виде разных типов геометрий.
   - Для сохранения нужных слоёв кликните правой кнопкой мыши на слой → **Export** → **Save Features As**:
     - Выберите формат данных (например, **ESRI Shapefile**).
     - Установите **CRS** — выбирайте спроецированную систему координат, **WGS-84 UTM XN zone** где X - номером зоны, соответствующий вашей территории (как определить номер зоны, разбирали на занятии).

---

### Этап 2: Настройки визуализации

Теперь, когда данные загружены, приступим к их оформлению!

Для оформления активируйте **Layer Styling Panel**:

- Кликните правой кнопкой мыши на пустом месте верхней панели и поставьте галочку напротив **Layer Styling Panel**.
- В открывшемся окне справа будут настройки для активного слоя (активный слой — тот, который выделен в списке слоев слева).

1. **Оформление зданий**:

   - Начните с настройки слоя со зданиями.
   - Выберите тип визуализации — **Single Symbol** и закрасьте их в чёрный или любой другой цвет, контрастный белому.

2. **Оформление землепользования**:

   - Для участков землепользования определите цвет в зависимости от атрибута, описывающего тип участка.
   - Используйте тип визуализации — **Categorized**, выбрав поле **Value** с указанием типа землепользования.

3. **Оформление других элементов**:
   - Примените визуальные стили для дорог, водоёмов и других элементов, которые планируете отобразить на карте.

> **Примечание:** Следите за порядком слоев (например, чтобы ж/д не уходили под воду).

---

> **Примечание:** Перед следующим этапом, если у вас участки землепользования или здания значительно выходят за границы района, то вам необходимо воспользоваться интсрументом clip, чтобы сохранить только те, которые находятся внутри района

- Откройте **Processing Toolbox** (Панель инструментов обработки), выбрав **View** → **Panels** → **Processing Toolbox**, если панель ещё не открыта.
- Введите в строке поиска инструментов "Clip" или найдите его в разделе **Vector overlay** (Наложение векторных данных).
- В настройках инструмента **Clip**:
  - **Input layer** (Входной слой) — выберите слой зданий, который нужно обрезать.
  - **Overlay layer** (Накладываемый слой) — выберите слой с границами района.
- Нажмите **Run** (Запуск) для выполнения обрезки.
- После завершения процесса обрезанный слой зданий будет автоматически добавлен на карту и отобразит только те здания, которые находятся внутри границ города
- Не забудьте сохранить новый слой (по аналогии с 1.4), так как он является временным

### Этап 3: Расчёты

#### Этап 3.1: Расчёт доли различных типов землепользования в границах района

На этом этапе мы рассчитаем долю каждого типа землепользования в пределах района.

### 1. Расчёт площади для каждого типа землепользования

- Откройте атрибутивную таблицу слоя землепользования:

  - Для этого кликните правой кнопкой мыши на слой землепользования и выберите **Open Attribute Table**.

- Если в таблице нет столбца с площадями, добавьте его:

  1.  Перейдите в режим редактирования:
      - Нажмите на кнопку **Toggle Editing Mode** в левом верхнем углу атрибутивной таблицы.
  2.  Откройте **Field Calculator** (Калькулятор полей):
      - Для этого нажмите на значок калькулятора или выберите **Layer** → **Field Calculator** в меню.
  3.  Создайте новый столбец для площади:
      - В поле **Output field name** введите название столбца (например, "Area_sq_m").
      - В поле **Output field type** выберите **Decimal number**.
  4.  В поле **Expression** введите выражение:
      ```plaintext
      $area
      ```
      - Это выражение автоматически вычислит площадь каждого полигона в квадратных метрах.
  5.  Нажмите **OK**, чтобы сохранить новый столбец.

- Теперь у каждого полигона будет указана его площадь в новом столбце "Area_sq_m".

### 2. Вычисление процентного соотношения каждого типа землепользования

- Чтобы вычислить долю каждого типа землепользования, выполните следующие шаги:

  1.  **Группировка по типам землепользования**:

      - Перейдите в **Processing Toolbox** (Обработку инструментов).
      - Найдите инструмент **Group Stats** или **Statistics by Categories** (если доступно).
      - Укажите обрезанный слой землепользования в качестве **Input layer**.
      - В поле **Category field** выберите столбец, в котором указан тип землепользования (например, `landuse`).
      - В поле **Values field** выберите столбец с площадью "Area_sq_m".
      - В качестве агрегатной функции выберите **Sum**, чтобы получить суммарную площадь для каждого типа землепользования.

  2.  **Расчёт доли каждого типа землепользования**:
      - В полученной таблице с результатами агрегации, откройте **Field Calculator** (Калькулятор полей).
      - Для расчёта доли каждого типа землепользования используйте следующее выражение:
        ```plaintext
        (поле с суммой площади для категории  / сумма всех площадей) * 100
        ```
        названия полей зависит от предудыщих этапов

- После выполнения этих шагов у вас будет таблица с процентными долями для каждого типа землепользования. Эти данные можно использовать для дальнейшего анализа и представления на карте

---

#### Этап 3.2: Расчёт процента застроенной территории

Это задача ещё проще: необходимо посчитать площадь района, вычислить общую сумму площадей подошв зданий и разделить её на общую площадь района.
Этапность шагов продумайте самостоятельно

### Этап 4: Создание Layout с двумя картами

1. Перейдите в меню **Project** → **Layout Manager** и создайте новый макет (Layout).
2. Добавьте два картографических фрейма (Map).
   - В первом фрейме отобразите слой зданий и гидрографию.
   - Во втором фрейме отобразите слои землепользования, дорог, железных дорог и гидрографии.

#### Использование тем (Themes) в QGIS

1. Темы позволяют сохранять разные комбинации видимых слоёв, что упрощает работу с макетами карт.
2. Настройте видимость слоёв для каждой карты:
   - В панели **Layers** включите и отключите слои в зависимости от требуемого содержания.
   - Создайте тему: выберите **View** → **Layer Styling** → **Themes** → **Add Theme**. Назовите тему, например, "Buildings" для первой карты и "Landuse" для второй.
3. В **Layout Manager** при добавлении фреймов выберите соответствующую тему для каждой карты, чтобы показать нужные слои.

---

### Этап 5: Добавление элементов карты

1. **Название**: Вставьте текстовый элемент для заголовка карты, отразив тематику карты.
2. **Легенда**: Добавьте легенду для обозначения типов землепользования, категорий зданий и других данных.
3. **Масштабная линейка**: Вставьте элемент масштабной линейки, выбрав подходящий единичный отрезок.
4. **Расчетные значения**: Добавьте текстовые элементы с результатами расчётов из этапов 4.1 и 4.2 (доли землепользования и процент застроенной территории).

---

### Этап 6: Сохранение итогового изображения

1. В **Layout Manager** выберите **Export as Image** (Экспортировать как изображение) и сохраните итоговый макет в формате PNG или JPEG.
2. Проверьте качество изображения, чтобы оно подходило для отчёта (= чтобы читалось все).

---

### Итог

После завершения работы у вас должны получиться две карты на одном листе, отражающие застройку и распределение землепользования на выбранном участке. На этом листе также должны быть приведены следующие расчёты:

- Процент застроенной территории
- Доли разных типов землепользования (для 5 категорий с максимальными долями)

**Сдача работы:** В ЛМС загрузите карту (в формате PNG, JPEG) и краткое описание исследуемой территории в отдельном текстовом документе.

**Удачи!**
